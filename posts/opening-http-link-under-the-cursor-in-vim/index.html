<!DOCTYPE html><html> <head><meta charset="utf-8"><title>Opening http link under the cursor in vim | Hi, I'm Nhân</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/theme/css/font.css"><link rel="stylesheet" href="/theme/css/pygment.css"><link rel="stylesheet" href="/theme/css/main.css"><link rel="stylesheet" href="/theme/css/article.css"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@nhanbt"><meta property="og:title" content="Opening http link under the cursor in vim"><meta property="og:description" content="Mr. Walter Bright, creator of the D programming language, recently commented on Hacker News: And for bug fixes, reference the issue which often gives a detailed explanation for why the code is a certain way:..."><meta property="og:image" content="../../images/keyboard-warrior.jpg"></head> <!--

Why hello there, source viewer. Here's a dragon for no particular reason:

       ^                       ^
       |\   \        /        /|
      /  \  |\__  __/|       /  \_
     / /\ \ \ _ \/ _ /      /    \_
    / / /\ \ {*}\/{*}      /  / \ \_
    | | | \ \( (00) )     /  // |\ \_
    | | | |\ \(V""V)\    /  / | || \|
    | | | | \ |^--^| \  /  / || || ||
   / / /  | |( WWWW__ \/  /| || || ||
  | | | | | |  \______\  / / || || ||
  | | | / | | )|______\ ) | / | || ||
  / / /  / /  /______/   /| \ \ || ||
 / / /  / /  /\_____/  |/ /__\ \ \ \ \_
 | | | / /  /\______/    \   \__| \ \ \_
 | | | | | |\______ __    \_    \__|_| \_
 | | ,___ /\______ _  _     \_       \  |
 | |/    /\_____  /    \      \__     \ |    /\_
 |/ |   |\______ |      |        \___  \ |__/  \_
 v  |   |\______ |      |            \___/     |
    |   |\______ |      |                    __/
     \   \________\_    _\               ____/
   __/   /\_____ __/   /   )\_,      _____/
  /  ___/  \____/  ___/___)    \______/
  VVV  V        VVV  V

(ripped off from http://www.retrojunkie.com/asciiart/myth/dragons.htm)

--> <body> <div id="main"> <header> <h1 id="site-name"><a href="/">Hi, I'm Nhân</a></h1> <h2 id="site-subtitle">and this is my humble corner on the intertubes.</h2> </header> <nav> <ul class="navbar" id="left-navbar"> <li><a href="/">Blog</a></li> <li><a href="../../about/">About</a></li> <li><a href="../../projects/">Projects</a></li> </ul> <ul class="navbar" id="right-navbar"> <li><a href="https://cv.imnhan.com">CV</a></li> <li><a href="/feeds/atom.xml">Feed</a></li> </ul> <div class="clearfix"></div> </nav> <div id="content"> <div class="article-content"> <article> <h1 class="article-title"> Opening http link under the cursor in vim </h1> <time datetime="2021-08-07 11:37:00+07:00"> August 07, 2021 </time> <p>Mr. <a href="https://www.walterbright.com/">Walter Bright</a>, creator of the D programming language, recently <a href="https://news.ycombinator.com/item?id=28090272">commented</a> on Hacker&nbsp;News:</p> <blockquote> <p>And for bug fixes, reference the issue which often gives a detailed explanation for why the code is a certain&nbsp;way:</p> <p><a href="https://github.com/dlang/dmd/blob/master/src/dmd/backend/cgxmm.d#L1210">https://github.com/dlang/dmd/blob/master/src/dmd/backend/cgxmm.d#L1210</a></p> <p>Ever since I enhanced the editor I use to open the browser on links, this sort of thing has proven to be very, very&nbsp;handy.</p> </blockquote> <p>I&rsquo;ve never had any issue with opening links from vim: I have <code>&lt;leader&gt;y</code> set up in Visual mode to yank stuff into the system-wide clipboard which I can then paste into the browser. However, ever since I mapped <code>&lt;leader&gt;gh</code> to trigger <a href="https://github.com/tpope/vim-fugitive/blob/2dc08dfe354ed5400f5cdb3d5009dcd4024aac8a/doc/fugitive.txt#L213"><code>:GBrowse</code></a> that opens a browser tab instantly, the old &ldquo;select, copy, alt-tab to browser, ctrl+t, ctrl+v&rdquo; flow started to feel&hellip; prehistoric. Mr. Bright&rsquo;s comment gave me the final nudge to actually go ahead and set it&nbsp;up.</p> <p>The good folks from the <a href="https://stackoverflow.com/questions/9458294/open-url-under-cursor-in-vim-with-browser">developer encyclopedia</a> suggested <code>gx</code> but for some reason, setting <code>g:netrw_browsex_viewer</code> <a href="https://github.com/vim/vim/issues/4738">didn&rsquo;t seem to do anything</a> so the command would always <code>wget</code> the link then tell the browser to open that downloaded file. Therefore, I cobbled together this snippet which was adapted from those stackoverflow <span class="amp">&amp;</span> github&nbsp;threads:</p> <div class="highlight"><pre><span></span><code><span class="k">function</span><span class="nf">! OpenURL</span><span class="p">()</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">matchstr</span><span class="p">(</span><span class="nb">expand</span><span class="p">(</span><span class="s">&quot;&lt;cWORD&gt;&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;https\=:\/\/[^ &gt;,;()]*&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">url</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shellescape</span><span class="p">(</span><span class="n">l</span><span class="p">:</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;!xdg-open &quot;</span><span class="p">.</span><span class="n">l</span><span class="p">:</span><span class="n">url</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span>
<span class="w">    </span><span class="n">silent</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s">&quot;No URL found under cursor.&quot;</span>
<span class="w">  </span><span class="n">endif</span>
<span class="n">endfunction</span>

<span class="s">nnoremap</span><span class="w"> </span><span class="s">gl</span><span class="w"> </span><span class="s">:call</span><span class="w"> </span><span class="s">OpenURL()&lt;cr&gt;</span>
</code></pre></div> <p><em>(if you&rsquo;re on a Mac, replacing <code>xdg-open</code> with <code>open</code> will probably do the same&nbsp;thing)</em></p> <p>Now whenever I have my cursor on an http(s) url, I can type <code>gl</code> from normal mode and xdg-open will use my default browser to open it up. This could be extended to any other scheme like <code>mailto</code> or <code>ftp</code> but I don&rsquo;t have any practical use for them right now so that will&nbsp;do.</p> <p>One drawback is if there&rsquo;s a whitespace in the <span class="caps">URL</span> (which is bad practice anyway), my regex won&rsquo;t match the whole thing. In such cases I&rsquo;d rather resort to good old manual visual mode than try to be clever and make my <span class="caps">URL</span> detecting logic exponentially more complex. I&rsquo;d take simple software with obvious, easily understood behavior over overcomplicated, (possibly) subtly broken balls of mud any&nbsp;day.</p> <p>By the way, if you looked at my script and got spooked by the idea of executing a shell command composed from arbitrary, potentially unsafe input (i.e. text file content), don&rsquo;t worry: that&rsquo;s what <a href="https://learnvimscriptthehardway.stevelosh.com/chapters/32.html#escaping-shell-command-arguments"><code>shellescape()</code></a> is&nbsp;for.</p> <h2 id="but-why-stop-there">But why stop there?<a class="headerlink" href="#but-why-stop-there" title="Permanent link">#</a></h2> <p>We&rsquo;re using Jira at work (I know, don&rsquo;t ask), and we have a convention to include the Jira ticket in all top-level git commit messages like this (French&nbsp;optional):</p> <div class="highlight"><pre><span></span><code>[SRE-123456] Finally fix the goddamn pipeline
</code></pre></div> <p>That&rsquo;s no <span class="caps">URL</span>, but the jira ticket <span class="caps">ID</span> pattern is pretty simple, so I simply altered the regexp a bit like&nbsp;this:</p> <div class="highlight"><pre><span></span><code><span class="k">function</span><span class="nf">! OpenJira</span><span class="p">()</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">jira_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">toupper</span><span class="p">(</span><span class="n">matchstr</span><span class="p">(</span><span class="nb">expand</span><span class="p">(</span><span class="s">&quot;&lt;cWORD&gt;&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;\c\(id2\|sre\|csi\)-[0-9]\+&#39;</span><span class="p">))</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">jira_id</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;!xdg-open https://my-company.atlassian.net/browse/&quot;</span><span class="p">.</span><span class="n">l</span><span class="p">:</span><span class="n">jira_id</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span>
<span class="w">    </span><span class="n">silent</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">l</span><span class="p">:</span><span class="n">command</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s">&quot;No Jira ticket found under cursor.&quot;</span>
<span class="w">  </span><span class="n">endif</span>
<span class="n">endfunction</span>
<span class="s">nnoremap</span><span class="w"> </span><span class="s">gj</span><span class="w"> </span><span class="s">:call</span><span class="w"> </span><span class="s">OpenJira()&lt;cr&gt;</span>
</code></pre></div> <p>Voila! Now I can press <code>gj</code> to open any atlassian ticket from just its <span class="caps">ID</span>.</p> <p>Some interesting&nbsp;points:</p> <ul> <li><code>ID2/SRE/CSI</code> are the prefixes that I know of. No idea if there are any other. Would be trivial to add later&nbsp;anyway.</li> <li>Because the pattern of l:jira_id is very simple, I don&rsquo;t even need to shellescape() this&nbsp;one.</li> <li>I didn&rsquo;t even bother to refactor common stuff between the OpenURL() and&nbsp;OpenJira().</li> </ul> <p>On a more big-picture note, I can afford to make seemingly sloppy decisions precisely because this serves only myself, and my specific use cases are usually narrow. It&rsquo;s not very general, but it works, and works precisely the way I want it. This is one of the reasons I&rsquo;ve always preferred simple tooling that I can build upon, rather than following the prescribed workflows of more full-fledged&nbsp;IDEs.</p> <p>I&rsquo;m not bashing IDEs, and I&rsquo;m in no way promoting vim or <a href="https://github.com/DigitalMars/med">rolling your own emacs</a>. I&rsquo;m firmly in the &ldquo;use whatever you&rsquo;re comfortable with&rdquo; camp. I think the whole idea of editor/<span class="caps">IDE</span> wars is juvenile, dumb and counterproductive (all software sucks in some way anyway, fight me). Showing nifty tricks you can do with your tools, inspiring others to either check them out or implement those on their own tools, just like how Mr. Bright has done with his little comment, is a much better use of everyone&rsquo;s time. I&nbsp;think.</p> </article> </div> <h2 id="comments">Comments</h2> <div id="disqus_thread"> <button id="showCommentBtn">Show comments via Disqus</button> <noscript><br>(enable JavaScript first though)</noscript> </div> <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // These need to be defined in the outermost scope, apparently.
    var disqus_shortname = 'nerdyweekly';
    var disqus_identifier = '/posts/opening-http-link-under-the-cursor-in-vim/';
    var disqus_url = '../../posts/opening-http-link-under-the-cursor-in-vim/';
    var disqus_title = 'Opening http link under the cursor in vim';

    document.querySelector('#showCommentBtn').addEventListener('click', function (event) {
        // Immediate visual feedback is always good:
        event.target.disabled = true;
        event.target.innerHTML = 'Loading comments...';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    });
</script> </div> <footer> &copy; 2013–2023 Bùi Thành Nhân <br> Built with &#9829; and probably too much <a target="_blank" rel="noopener" href="https://www.alambe.vn/products/ca-phe-rang-xay-alambe-sai-gon">cà phê sữa đá</a>. <p class="easter-egg" style="display: none; font-size: .7em; margin: 0; color: var(--bg-color);"> Bored? Try entering the Konami code from your keyboard. </p> <script>
        document.querySelector('.easter-egg').style.display = 'block';
      </script> </footer> </div> <script src="/theme/konami.js"></script> </body> </html>