<!DOCTYPE html><html> <head><meta charset="utf-8"><title>Towards an acceptable video playing experience | Hi, I'm Nhân</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/theme/css/font.css"><link rel="stylesheet" href="/theme/css/pygment.css"><link rel="stylesheet" href="/theme/css/main.css"><link rel="stylesheet" href="/theme/css/article.css"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@nhanbt"><meta property="og:title" content="Towards an acceptable video playing experience"><meta property="og:description" content="I watch movies and TV shows. Naturally, I have some strong preferences on how to view them: English subtitles. Most things I watch are in English. Although I’m perfectly comfortable with face-to-face English conversations, I just can’t keep up with..."><meta property="og:image" content="../../images/keyboard-warrior.jpg"></head> <!--

Why hello there, source viewer. Here's a dragon for no particular reason:

       ^                       ^
       |\   \        /        /|
      /  \  |\__  __/|       /  \_
     / /\ \ \ _ \/ _ /      /    \_
    / / /\ \ {*}\/{*}      /  / \ \_
    | | | \ \( (00) )     /  // |\ \_
    | | | |\ \(V""V)\    /  / | || \|
    | | | | \ |^--^| \  /  / || || ||
   / / /  | |( WWWW__ \/  /| || || ||
  | | | | | |  \______\  / / || || ||
  | | | / | | )|______\ ) | / | || ||
  / / /  / /  /______/   /| \ \ || ||
 / / /  / /  /\_____/  |/ /__\ \ \ \ \_
 | | | / /  /\______/    \   \__| \ \ \_
 | | | | | |\______ __    \_    \__|_| \_
 | | ,___ /\______ _  _     \_       \  |
 | |/    /\_____  /    \      \__     \ |    /\_
 |/ |   |\______ |      |        \___  \ |__/  \_
 v  |   |\______ |      |            \___/     |
    |   |\______ |      |                    __/
     \   \________\_    _\               ____/
   __/   /\_____ __/   /   )\_,      _____/
  /  ___/  \____/  ___/___)    \______/
  VVV  V        VVV  V

(ripped off from http://www.retrojunkie.com/asciiart/myth/dragons.htm)

--> <body> <div id="main"> <header> <h1 id="site-name"><a href="/">Hi, I'm Nhân</a></h1> <h2 id="site-subtitle">and this is my humble corner on the intertubes.</h2> </header> <nav> <ul class="navbar" id="left-navbar"> <li><a href="/">Blog</a></li> <li><a href="../../about/">About</a></li> <li><a href="../../projects/">Projects</a></li> </ul> <ul class="navbar" id="right-navbar"> <li><a href="https://cv.imnhan.com">CV</a></li> <li><a href="/feeds/atom.xml">Feed</a></li> </ul> <div class="clearfix"></div> </nav> <div id="content"> <div class="article-content"> <article> <h1 class="article-title"> Towards an acceptable video playing experience </h1> <time datetime="2020-04-26 10:06:00+07:00"> April 26, 2020 </time> <p>I watch movies and <span class="caps">TV</span> shows. Naturally, I have some strong preferences on how to view&nbsp;them:</p> <p><strong>English subtitles</strong>. Most things I watch are in English. Although I&rsquo;m perfectly comfortable with face-to-face English conversations, I just can&rsquo;t keep up with English dialogue in movies. I also don&rsquo;t want to put up with badly translated subs, so English subtitles they must be. This rules out most Vietnamese&nbsp;&ldquo;netflixes&rdquo;.</p> <p><strong>1080p</strong>, unless it&rsquo;s ancient or super rare&nbsp;stuff.</p> <p><strong>Streamable from tablets</strong>. I shouldn&rsquo;t need to turn on my <span class="caps">PC</span> just to catch up on the latest Better Call Saul&nbsp;episode.</p> <p>In 2020, there sure are a variety of options available, all of which fall short in some&nbsp;ways:</p> <ul> <li> <p>Shady ad-infested Vietnamese movie streaming sites (phimmoi etc): Obnoxious pop-up tabs aside, they always <a href="https://kipalog.com/posts/Cac-web-phim-da-giam-99-99--chi-phi-bang-google-drive-nhu-the-nao">abuse Google Drive</a> (or even Facebook?) storage behind the scene. Problem is Google Drive encoding is lossy as hell, so even at 1080p they look noticeably worse than the original. Also they almost always come with hardcoded Vietnamese&nbsp;subs.</p> </li> <li> <p>Netflix clones by big ISPs: Pathetic catalogues. Vietnamese&nbsp;subs.</p> </li> <li> <p>Netflix itself: Actually quite good thanks to usable Android app, but besides the increasingly shitty catalogue, it&rsquo;s <a href="https://help.netflix.com/en/node/23742">impossible to get 1080p from Linux</a>. Also I hate that I can&rsquo;t manually set the video quality: even if my current connection gets slow I&rsquo;d rather pause and wait for buffering instead of putting up with a pixelated 480p mess. I still have my Netflix subscription today, but only&nbsp;grudgingly.</p> </li> <li> <p><span class="dquo">&ldquo;</span>dude, like, just torrent it&rdquo;. Solid advice since torrents usually come with embedded English sub, but it requires actually downloading the thing first, and can&rsquo;t easily switch devices without moving the file&nbsp;along.</p> </li> <li> <p>Setting up a torrent + plex server? That would require (1) ample disk space, (2) generous network bandwidth, (3) actual horsepower for transcoding and (4) fast enough network access from home or wherever I watch movies&nbsp;from.</p> <ul> <li> <p>A local <span class="caps">NAS</span>-style server satisfies (1), (3) <span class="amp">&amp;</span> (4) but struggles with (2), and I don&rsquo;t want it to hog my home internet&nbsp;pipes.</p> </li> <li> <p>Finding a <span class="caps">VPS</span> service with (1) <span class="amp">&amp;</span> (2) is doable, but (3) gets expensive fast and usually they&rsquo;re in the <span class="caps">US</span> or <span class="caps">EU</span> which can never have (4). I&rsquo;m actually running a seedbox on Ramnode but can&rsquo;t run plex on it because of lack of (3) and (4). If I&rsquo;m willing to pay more I can get a Hetzner dedicated server which can probably do (3) but (4) gets even&nbsp;worse.</p> </li> </ul> </li> </ul> <h2 id="remote-seedbox-google-drive">Remote seedbox + Google Drive<a class="headerlink" href="#remote-seedbox-google-drive" title="Permanent link">#</a></h2> <p>I settled on Netflix and torrented stuff that&rsquo;s not available there. For the seedbox, I installed Transmission-web on a Ramnode <span class="caps">VPS</span> that has <span class="caps">320GB</span> of <span class="caps">HDD</span> at $50/year. The network bandwidth is meh but it gets the job&nbsp;done.</p> <p>Since Transmission supports hooks via external scripts, I set it up so that downloaded torrents get uploaded to my Google Drive using <code>rclone</code>.</p> <p>Now whenever I find something interesting that&rsquo;s not on Netflix, I look for a working torrent file and tell my seedbox to get it. Thanks to the web interface I can do it from both my <span class="caps">PC</span> and tablet. I don&rsquo;t have to keep my devices running so it doesn&rsquo;t matter if the torrent is not well-seeded and takes a long&nbsp;time.</p> <p>Once the file lands on Google Drive, I can&nbsp;either:</p> <ul> <li> <p>watch it directly from GDrive&rsquo;s web/Android app if I don&rsquo;t care about subtitles or original quality,&nbsp;or</p> </li> <li> <p>download the file first and watch&nbsp;properly</p> </li> </ul> <p>The latter is not&nbsp;ideal.</p> <h2 id="enter-gflick">Enter gflick<a class="headerlink" href="#enter-gflick" title="Permanent link">#</a></h2> <p>Turns out advanced video players like <code>mpv</code> and <code>vlc</code> can directly stream <span class="caps">HTTP</span> videos with full support for seeking and audio / text(a.k.a subtitles) tracks. See, well-formed video container formats will have metadata at the beginning of the file telling where each track lies within the file. The player can download just the metadata first, then the subtitle track, then the actual video track starting from a specific position. This is only possible if the http server supports partial content download <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range">via the <code>Range</code> header</a>.</p> <p>Google Drive does have a &ldquo;direct link&rdquo; <span class="caps">API</span> in the form of <code>https://www.googleapis.com/drive/v3/files/&lt;fileId&gt;?alt=media</code>, which luckily supports partial download. The bad news is downloading private files requires authentication via a bearer token. The only <span class="caps">HTTP</span> authentication scheme that these players support, as far as I know, is <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#Basic_authentication_scheme">Basic auth</a>.</p> <p>So I wrote <a href="https://github.com/nhanb/gflick">gflick</a>, which is practically an <span class="caps">HTTP</span> proxy that does Google authentication behind the scene, exposing a plain <span class="caps">HTTP</span> streaming endpoint so <code>mpv</code> and the like can use without&nbsp;modification.</p> <p>Here&rsquo;s what it looks like in&nbsp;action:</p> <video controls> <source src="https://junk.imnhan.com/gflick.mp4" type="video/mp4"> <a href="https://junk.imnhan.com/gflick.mp4"> Video: https://junk.imnhan.com/gflick.mp4 </a> </video> <p>It can run just fine as a local server, but cumbersome and not practical on tablets, so I put it on a publicly accessible server, protected by nginx which does <span class="caps">TLS</span> and Basic Auth. As mentioned earlier, good video players can do basic auth out of the box. Gflick also exposes a simple web interface to browse my Google Drives, so now I can browse my drive on any pc/tablet, and watch things with full seek, subtitle/audio track support,&nbsp;right?</p> <p>Not quite. While desktop versions of these players work fine, their Android versions won&rsquo;t play it. Now I regret selling my Surface Go!&nbsp;:(</p> <p>And&hellip; that&rsquo;s where I&rsquo;m stuck at the moment. Not sure if I should buy one of those Chinese Surface knock-offs or&nbsp;what.</p> <h2 id="other-failed-attempts">Other failed attempts<a class="headerlink" href="#other-failed-attempts" title="Permanent link">#</a></h2> <ul> <li><a href="https://github.com/nhanb/mpv-gdrive">mpv-gdrive</a>: Using mpv&rsquo;s lua scripting <span class="caps">API</span> to automatically set the correct bearer auth headers. Worked fine on desktop, failed miserably on&nbsp;android.</li> <li><a href="https://github.com/nhanb/drivein">drivein</a>: Uses <code>rclone mount</code>. Worked fine on desktop, android wouldn&rsquo;t allow mounting without&nbsp;root.</li> </ul> <p>Also both of those required setting up each client device. Not&nbsp;ideal.</p> <h3 id="update-june-10-2020">Update June 10, 2020<a class="headerlink" href="#update-june-10-2020" title="Permanent link">#</a></h3> <p>The sequel is out: <a href="/posts/streaming-videos-from-google-drive-a-second-attempt/">Streaming videos from Google Drive - a second&nbsp;attempt</a></p> </article> </div> <h2 id="comments">Comments</h2> <div id="disqus_thread"> <button id="showCommentBtn">Show comments via Disqus</button> <noscript><br>(enable JavaScript first though)</noscript> </div> <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // These need to be defined in the outermost scope, apparently.
    var disqus_shortname = 'nerdyweekly';
    var disqus_identifier = '/posts/towards-an-acceptable-video-playing-experience/';
    var disqus_url = '../../posts/towards-an-acceptable-video-playing-experience/';
    var disqus_title = 'Towards an acceptable video playing experience';

    document.querySelector('#showCommentBtn').addEventListener('click', function (event) {
        // Immediate visual feedback is always good:
        event.target.disabled = true;
        event.target.innerHTML = 'Loading comments...';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    });
</script> </div> <footer> &copy; 2013–2023 Bùi Thành Nhân <br> Built with &#9829; and probably too much <a target="_blank" rel="noopener" href="https://www.alambe.vn/products/ca-phe-rang-xay-alambe-sai-gon">cà phê sữa đá</a>. <p class="easter-egg" style="display: none; font-size: .7em; margin: 0; color: var(--bg-color);"> Bored? Try entering the Konami code from your keyboard. </p> <script>
        document.querySelector('.easter-egg').style.display = 'block';
      </script> </footer> </div> <script src="/theme/konami.js"></script> </body> </html>